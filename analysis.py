import os
from openai import OpenAI
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–ª—é—á–∏
load_dotenv()
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

async def get_crypto_analysis(ticker):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ OpenAI –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –º–æ–Ω–µ—Ç—ã.
    """
    # –¢–≤–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç
    prompt = f"""
    –ü—Ä–æ–≤–µ–¥–∏ –≥–ª—É–±–æ–∫–∏–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–æ–Ω–µ—Ç—ã {ticker.upper()}.
    
    –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–π –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤):
    
    1. üíé –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å
    - –ö–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç? (Utility/USP)
    - –ö—Ç–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã –∏ –≤ —á–µ–º –æ—Ç–ª–∏—á–∏–µ?
    - –ö–æ–º–∞–Ω–¥–∞ –∏ Roadmap (–∫—Ä–∞—Ç–∫–æ).

    2. üìä –¢–æ–∫–µ–Ω–æ–º–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏
    - TVL –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–µ—Ç–∏.
    - –ò–Ω—Ñ–ª—è—Ü–∏—è/–¥–µ—Ñ–ª—è—Ü–∏—è, –≤–µ—Å—Ç–∏–Ω–≥–∏ (—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏).
    - –î—Ä–∞–π–≤–µ—Ä—ã —Ä–æ—Å—Ç–∞.

    3. üåç –ú–∞–∫—Ä–æ –∏ –†—ã–Ω–æ–∫
    - –í–ª–∏—è–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –§–†–° –∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.
    - –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å BTC.
    - –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞.

    4. ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
    - –ì–ª–∞–≤–Ω—ã–µ —Ä–∏—Å–∫–∏ (—Ä–µ–≥—É–ª—è—Ü–∏—è, –≤–∑–ª–æ–º—ã).
    - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ "—á–µ—Ä–Ω—ã–µ –ª–µ–±–µ–¥–∏" –∏–ª–∏ –ø—Ä–æ—Ä—ã–≤—ã.

    5. üéØ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ (–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –≤–∑–≥–ª—è–¥)
    - –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª (–±–µ–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–æ–≤–µ—Ç–æ–≤).
    
    –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º, –≤ —Ñ–æ—Ä–º–∞—Ç–µ Telegram Markdown.
    """

    try:
        response = client.chat.completions.create(
            model="gpt-4o-mini",  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –±—ã—Å—Ç—Ä—É—é –∏ —É–º–Ω—É—é –º–æ–¥–µ–ª—å
            messages=[
                {"role": "system", "content": "–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫—Ä–∏–ø—Ç–æ-–∞–Ω–∞–ª–∏—Ç–∏–∫ —É—Ä–æ–≤–Ω—è Senior Hedge Fund Analyst."},
                {"role": "user", "content": prompt}
            ],
            temperature=0.7
        )
        return response.choices[0].message.content
    except Exception as e:
        return f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: {str(e)}"